function Jangle() { this.vars = { novar: 0 }, this.startX = 0, this.startValue = 0, this.drawfun = null, this.code = null, this.down = !1, this.ai = -1, this.exampleid = null; var d = this; this.clear = function (e) { e.fillStyle = "#ffffff", e.fillRect(0, 0, d.canvas.width, d.canvas.height) }, this.invokeFunction = function () { var e = d.canvas.getContext("2d"); d.clear(e), e.save(), e.strokeStyle = "black"; var t = [e]; for (var n in d.vars) t.push(d.vars[n]); d.drawfun.apply(this, t), e.restore() }, this.setup = function (r) { d.exampleid = r; var e = {}; for (var t in d.vars) { e[a = r + "_" + t] = d.vars[t] } d.canvas = $("#" + r + " canvas")[0], d.code = $("#" + r + " pre")[0], d.invokeFunction(); for (var n = d.drawfun.toString().split("\n"), o = "", s = 0; s < n.length; s++)0 != s && s != n.length - 1 && (o += n[s], o += "\n"); for (var t in o = o.replace("<", "&lt;"), d.vars) { var a = r + "_" + t; o = o.replace(new RegExp(t), "<b id='" + a + "'>" + d.vars[t] + "</b>") } for (var t in d.vars = e, d.code.innerHTML = o, $("#" + r + " .popup").hide(), d.vars) { var i = document.getElementById("" + t); $(i).bind("mousedown", function (e) { var t = $("#" + r + " .popup"), n = $(this).attr("id"); e.preventDefault(), d.startX = e.clientX, d.startValue = d.vars[n], d.down = !0, d.addListeners(), d.activeID = n, t.show(); var o = $("#" + r).offset(), s = $(this).offset(); t.css("top", s.top - o.top - 80 + "px"), t.css("left", e.pageX - o.left - 30 + "px") }), i.addEventListener("touchstart", function (e) { var t = $("#" + r + " .popup"), n = $(this).attr("id"); e.preventDefault(); var o = e.touches[0], s = o.pageX; o.pageY; d.startX = s, d.startValue = d.vars[n], d.down = !0, d.addListeners(), d.activeID = n, t.show(); var a = $("#" + r).offset(), i = $(this).offset(); t.css("top", i.top - a.top - 80 + "px"), t.css("left", s - a.left - 30 + "px"), t.text("" + d.startValue) }) } }, this.doc_mouse_move = function (e) { if (d.down && (e.preventDefault(), 1 == e.which)) { var t = e.clientX - d.startX + d.startValue; d.vars[d.activeID] = t, document.getElementById(d.activeID).innerHTML = t, d.invokeFunction(); var n = $("#" + d.exampleid + " .popup"), o = $("#" + d.exampleid).offset(); $(this).offset(); n.css("left", e.pageX - o.left - 30 + "px"), n.get(0).innerHTML = "" + t } }, this.doc_touch_move = function (e) { var t = e.touches[0].pageX; if (d.down) { e.preventDefault(); var n = t - d.startX + d.startValue; d.vars[d.activeID] = n, document.getElementById(d.activeID).innerHTML = n, d.invokeFunction(); var o = $("#" + d.exampleid + " .popup"), s = $("#" + d.exampleid).offset(); o.css("left", t - s.left - 30 + "px"), o.get(0).innerHTML = "" + n } }, this.doc_mouse_up = function (e) { d.down && (e.preventDefault(), d.down = !1, d.removeListeners(), $("#" + d.exampleid + " .popup").hide()) }, this.doc_touch_end = function (e) { var t = e.changedTouches[0]; e.preventDefault(), d.down = !1, d.removeListeners(), $("#" + d.exampleid + " .popup").hide(); t.pageX }, this.addListeners = function () { document.addEventListener("mousemove", d.doc_mouse_move), document.addEventListener("touchmove", d.doc_touch_move), document.addEventListener("touchend", d.doc_touch_end), document.addEventListener("mouseup", d.doc_mouse_up) }, this.removeListeners = function () { document.removeEventListener("mousemove", d.doc_mouse_move), document.addEventListener("touchmove", d.doc_touch_move), document.addEventListener("touchend", d.doc_touch_end), document.removeEventListener("mouseup", d.doc_mouse_up) } }